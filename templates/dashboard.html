{% extends 'base.html' %}
{% block title %}仪表盘{% endblock %}
{% block head %}
<!--<script src="{{ url_for('static', filename='echarts.min.js') }}"></script>-->
<script src="https://cdnjs.snrat.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
{% endblock %}
{% block content %}
<div class="row mb-4">
    <div class="col">
        <div class="card text-white bg-info mb-3">
            <div class="card-body">
                <h5 class="card-title">今日销售额</h5>
                <p class="card-text">{{ today_total }}</p>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card text-white bg-secondary mb-3">
            <div class="card-body">
                <h5 class="card-title">昨日销售额</h5>
                <p class="card-text">{{ yesterday_total }}</p>
            </div>
        </div>
    </div>
    <div class="col">
        <div class="card text-white bg-success mb-3">
            <div class="card-body">
                <h5 class="card-title">历史总销售额</h5>
                <p class="card-text">{{ all_total }}</p>
            </div>
        </div>
    </div>
</div>

<div class="row mb-4">
    <div class="col-md-6">
        <div id="cat-sale-pie" style="width:100%;height:300px;"></div>
    </div>
    <div class="col-md-6">
        <h5>销售排行榜（销售额）</h5>
        <table class="table table-sm">
            <tr><th>商品</th><th>总销售额</th><th>总销量</th></tr>
            {% for item in sale_ranks %}
            <tr>
                <td>{{ item[0] }}</td>
                <td>{{ item[1] }}</td>
                <td>{{ item[2] }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
</div>
<hr>
<h5>最近20条销售流水</h5>
<table class="table table-bordered">
    <tr>
        <th>商品</th><th>数量</th><th>金额</th><th>时间</th>
    </tr>
    {% for s in sales %}
    <tr>
        <td>{{ s.product.name }}</td>
        <td>{{ s.quantity }}</td>
        <td>{{ s.amount }}</td>
        <td>{{ s.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
    </tr>
    {% endfor %}
</table>
<script>
var myChart = echarts.init(document.getElementById('cat-sale-pie'));
var option = {
    title: {text: '分类销售额占比', left: 'center'},
    tooltip: {trigger: 'item'},
    legend: {orient: 'vertical', left: 'left'},
    series: [{
        name: '销售额',
        type: 'pie',
        radius: '60%',
        data: [
            {% for i in range(cat_names|length) %}
            {value: {{ cat_amounts[i] }}, name: "{{ cat_names[i] }}"}{% if not loop.last %},{% endif %}
            {% endfor %}
        ]
    }]
};
myChart.setOption(option);
</script>
{% endblock %}
